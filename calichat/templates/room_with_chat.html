{% extends "layout.html" %}

{% block titlehead %}{{ chat_room.title }}{% endblock %}

{% block head%}
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
	<script type="text/javascript" charset="utf-8">
		$(document).ready(function() {
			let SERVER_URL = location.protocol + '//{{ config.SERVER_NAME }}{{ config.SOCKET_NAMESPACE }}';

			let socket = io.connect(SERVER_URL);

			socket.on('connect', function() {
		        socket.emit('echo_event', {data: 'I\'m connected!'});
		    });

			// this is the event handler that takes care of all the messages received from the server
			socket.on('chat_response', function(msgJson) {
		        $('#chat_content').append($('<div/>').text(msgJson.data).html() + '<br/>');
		    });

			$('form#broadcast').submit(function(event) {
		        socket.emit('broadcast_event', {data: $('#broadcast_data').val()});
		        return false;
		    });
		});

	</script>
{% endblock %}

{% block body %}

	<h3>{{ chat_room.title }} (<a href="{{ url_for('room_list') }}">leave</a>)</h3>

    <div class="chat-content" id="chat_content"></div>

	<form id="broadcast" method="POST" action='#'>
        <input type="text" name="broadcast_data" id="broadcast_data" placeholder="Message">
        <input type="submit" value="Broadcast">
    </form>
{% endblock %}